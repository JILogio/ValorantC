version: 2.1

orbs:
  node: circleci/node@5.2
  slack: circleci/slack@4.8.0  # Orb de Slack para notificaciones

executors:
  node-executor:
    docker:
      - image: circleci/node:18.17

jobs:
  # Job 1: Clonar el repositorio
  clone_repo:
    executor: node-executor
    steps:
      - checkout  # Clona el repositorio
      - run:
          name: Verify Repo Clone
          command: ls -al  # Verificar que se ha clonado correctamente

  # Job 2: Correr los tests
  run_tests:
    executor: node-executor
    parallelism: 2
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
          app-dir: esports-valorant-backend/
      - run:
          name: Run Tests
          command: npm run test  # Comando para correr las pruebas
          working_directory: esports-valorant-backend/

  # Job: Lint Code
  lint_code:
    executor: node-executor
    steps:
      - checkout
      - node/install-packages:
          pkg-manager: npm
          app-dir: esports-valorant-backend/
      - run:
          name: Lint Code
          command: npm run lint  # Comando para revisar el estilo de c√≥digo
          working_directory: esports-valorant-backend/

workflows:
  # Segundo workflow: Lint y Build
  lint_and_build:
    jobs:
      - lint_code

# Notificaciones de Slack
notify_on_success:
  jobs:
    - slack/notify:
        channel: "#devops"
        event: success
notify_on_failure:
  jobs:
    - slack/notify:
        channel: "#devops"
        event: fail