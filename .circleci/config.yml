version: 2.1

orbs:
  node: circleci/node@5.2
  slack: circleci/slack@4.8.0  # Orb de Slack para notificaciones

executors:
  node-executor:
    docker:
      - image: circleci/node:16.10

jobs:
  # Job 1: Clonar el repositorio
  clone_repo:
    executor: node-executor
    steps:
      - checkout  # Clona el repositorio
      - run:
          name: Verify Repo Clone
          command: ls -al  # Verificar que se ha clonado correctamente

  # Job 2: Correr los tests
  run_tests:
    executor: node-executor
    steps:
      - checkout
      - node/install-packages:
          app-dir: esports-valorant-backend
          pkg-manager: npm
      - run:
          name: Run Tests
          command: npm run test  # Comando para correr las pruebas

  # Job: Lint Code
  lint_code:
    executor: node-executor
    steps:
      - checkout
      - node/install-packages:
          app-dir: esports-valorant-backend
          pkg-manager: npm
      - run:
          name: Lint Code
          command: npm run lint  # Comando para revisar el estilo de c√≥digo

workflows:
  # Primer workflow: Clonar el repo y correr los tests
  clone_and_test:
    jobs:
      - clone_repo
      - run_tests:
          requires:
            - clone_repo

  # Segundo workflow: Lint y Build
  lint_and_build:
    jobs:
      - lint_code

# Notificaciones de Slack
notify_on_success:
  jobs:
    - slack/notify:
        channel: "#devops"
        event: success
notify_on_failure:
  jobs:
    - slack/notify:
        channel: "#devops"
        event: fail